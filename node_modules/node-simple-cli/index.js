
const stdin = process.openStdin();

const commands = {}

function register(cmd, callback)
{
	commands[cmd] = callback
}

register('echo', (args) =>
{
	return args
})

module.exports.register = register

stdin.addListener('data', function(d) 
{
	const input = d.toString().trim()

	if(input.length <= 1)
	{
		return
	} 

	const commandEnd = input.indexOf('(')

	const command = commandEnd == -1 ? input : input.substr(0, commandEnd)

	var args = null

	if(commandEnd != -1)
	{
		const argsStr = input.substr(commandEnd, input.length).trim()

		if(argsStr.length > 2)
		{
			try
			{
				args = eval(argsStr)

			}catch(e)
			{
				console.log(e)
				console.log('invalid arguments')
			}
		}
	}

	if(command in commands)
	{
		console.log(commands[command](args))

	}else
	{
		console.log('command not found')
	}
})